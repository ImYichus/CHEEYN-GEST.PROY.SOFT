generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id             Int        @id @default(autoincrement())
  nombre         String
  email          String     @unique
  passwordHash   String
  rol            RolUsuario @default(CLIENTE)
  direccionEnvio String?
  createdAt      DateTime   @default(now())
  pedidos        Pedido[]
}

model Categoria {
  id          Int        @id @default(autoincrement())
  nombre      String     @unique
  descripcion String?
  productos   Producto[]
}

model Producto {
  id              Int              @id @default(autoincrement())
  nombre          String
  descripcion     String?
  precio          Decimal          @db.Decimal(65, 2)
  sku             String           @unique
  imagenUrl       String?
  categoriaId     Int
  categoria       Categoria        @relation(fields: [categoriaId], references: [id])
  variantes       VarianteProducto[]
  multimedia      MultimediaProducto[]
}

model VarianteProducto {
  id              Int              @id @default(autoincrement())
  talla           String
  color           String
  stock           Int              @default(0)
  inStock         Boolean          @default(true)
  productoId      Int
  producto        Producto         @relation(fields: [productoId], references: [id], onDelete: Cascade)
  itemsPedido     DetallePedido[]

  @@unique([productoId, talla, color])
}

model MultimediaProducto {
  id         Int      @id @default(autoincrement())
  productoId Int
  url        String
  esImagen   Boolean  @default(true)
  orden      Int      @default(0)
  producto   Producto @relation(fields: [productoId], references: [id], onDelete: Cascade)

  @@unique([productoId, orden])
}

model Pedido {
  id             Int             @id @default(autoincrement())
  fechaPedido    DateTime        @default(now())
  estado         EstadoPedido    @default(PENDIENTE)
  total          Decimal         @db.Decimal(65, 2)
  direccionEnvio String
  usuarioId      Int
  detalles       DetallePedido[]
  usuario        Usuario         @relation(fields: [usuarioId], references: [id])
}

model DetallePedido {
  id             Int              @id @default(autoincrement())
  cantidad       Int
  precioUnitario Decimal          @db.Decimal(65, 2)
  pedidoId       Int
  varianteId     Int
  pedido         Pedido           @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  variante       VarianteProducto @relation(fields: [varianteId], references: [id])
}

enum RolUsuario {
  CLIENTE
  ADMIN
}

enum EstadoPedido {
  PENDIENTE
  PAGADO
  PROCESANDO
  ENVIADO
  ENTREGADO
  CANCELADO
}