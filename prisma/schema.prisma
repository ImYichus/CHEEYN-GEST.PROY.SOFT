generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id             Int        @id @default(autoincrement())
  nombre         String     @db.VarChar(255)
  email          String     @unique @db.VarChar(255)
  passwordHash   String     @db.VarChar(255)
  rol            RolUsuario @default(CLIENTE)
  direccionEnvio String?
  createdAt      DateTime   @default(now())
  pedidos        Pedido[]
}

model Categoria {
  id          Int        @id @default(autoincrement())
  nombre      String     @unique @db.VarChar(255)
  descripcion String?
  productos   Producto[]
}

model Producto {
  id                  Int                  @id @default(autoincrement())
  nombre              String               @db.VarChar(255)
  descripcion         String?
  precio              Decimal              @db.Decimal(65, 2)
  sku                 String               @unique @db.VarChar(255)
  categoriaId         Int
  multimediaProductos MultimediaProducto[]
  categoria           Categoria            @relation(fields: [categoriaId], references: [id], onUpdate: NoAction)
  variantes           VarianteProducto[]
}

model VarianteProducto {
  id          Int             @id @default(autoincrement())
  talla       String          @db.VarChar(50)
  color       String          @db.VarChar(50)
  stock       Int             @default(0)
  inStock     Boolean
  productoId  Int
  itemsPedido DetallePedido[]
  producto    Producto        @relation(fields: [productoId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([productoId, talla, color])
}

model MultimediaProducto {
  id         Int      @id @default(autoincrement())
  productoId Int
  url        String
  esImagen   Boolean  @default(true)
  orden      Int      @default(0)
  producto   Producto @relation(fields: [productoId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([productoId, orden])
}

model Pedido {
  id             Int             @id @default(autoincrement())
  fechaPedido    DateTime        @default(now())
  estado         EstadoPedido    @default(PENDIENTE)
  total          Decimal         @db.Decimal(65, 2)
  direccionEnvio String
  usuarioId      Int
  detalles       DetallePedido[]
  usuario        Usuario         @relation(fields: [usuarioId], references: [id], onUpdate: NoAction)
}

model DetallePedido {
  id             Int              @id @default(autoincrement())
  cantidad       Int
  precioUnitario Decimal          @db.Decimal(65, 2)
  pedidoId       Int
  varianteId     Int
  pedido         Pedido           @relation(fields: [pedidoId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  variante       VarianteProducto @relation(fields: [varianteId], references: [id], onUpdate: NoAction)
}

enum RolUsuario {
  CLIENTE
  ADMIN
}

enum EstadoPedido {
  PENDIENTE
  PAGADO
  ENVIADO
  ENTREGADO
  CANCELADO
}
