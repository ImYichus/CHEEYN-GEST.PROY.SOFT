generator client {
  provider = "prisma-client-js"
<<<<<<< HEAD
  output   = "../app/generated/prisma"
=======
>>>>>>> 5d06b0262f83c936110fd1f9e34124d9fb2727a0
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

<<<<<<< HEAD
=======
// ==========================================================
// MODELOS DE LA BASE DE DATOS
// ==========================================================

//Usuarios (Clientes y Administradores)
>>>>>>> 5d06b0262f83c936110fd1f9e34124d9fb2727a0
model Usuario {
  id             Int        @id @default(autoincrement())
  nombre         String     @db.VarChar(255)
  email          String     @unique @db.VarChar(255)
  passwordHash   String     @db.VarChar(255)
  rol            RolUsuario @default(CLIENTE)
  direccionEnvio String?
  createdAt      DateTime   @default(now())
  pedidos        Pedido[]
}

model Categoria {
  id          Int        @id @default(autoincrement())
  nombre      String     @unique @db.VarChar(255)
  descripcion String?
  productos   Producto[]
}

model Producto {
<<<<<<< HEAD
  id                  Int                  @id @default(autoincrement())
  nombre              String               @db.VarChar(255)
  descripcion         String?
  precio              Decimal              @db.Decimal(65, 2)
  sku                 String               @unique @db.VarChar(255)
  categoriaId         Int
  multimediaProductos MultimediaProducto[]
  categoria           Categoria            @relation(fields: [categoriaId], references: [id], onUpdate: NoAction)
  variantes           VarianteProducto[]
=======
  id              Int              @id @default(autoincrement())
  nombre          String
  descripcion     String?
  precio          Decimal          @db.Decimal(65, 2) //Precio base
  sku             String           @unique            //Stock Keeping Unit
  imagenUrl       String?

  //Clave Foránea a Categoria
  categoriaId     Int
  categoria       Categoria        @relation(fields: [categoriaId], references: [id])

  //Relaciones
  variantes       VarianteProducto[] //Una camiseta puede tener muchas variantes (talla S, color azul; talla M, color rojo, etc.)
  multimedia      MultimediaProducto[]
>>>>>>> 5d06b0262f83c936110fd1f9e34124d9fb2727a0
}

model VarianteProducto {
<<<<<<< HEAD
  id          Int             @id @default(autoincrement())
  talla       String          @db.VarChar(50)
  color       String          @db.VarChar(50)
  stock       Int             @default(0)
  inStock     Boolean
  productoId  Int
  itemsPedido DetallePedido[]
  producto    Producto        @relation(fields: [productoId], references: [id], onDelete: Cascade, onUpdate: NoAction)

=======
  id              Int              @id @default(autoincrement())
  talla           String
  color           String
  stock           Int              @default(0)

  //Clave Foránea a Producto
  productoId      Int
  producto        Producto         @relation(fields: [productoId], references: [id])

  //Relaciones
  itemsPedido     DetallePedido[]

  //Restricción única para asegurar que un producto no tenga dos veces la misma combinación de talla/color
>>>>>>> 5d06b0262f83c936110fd1f9e34124d9fb2727a0
  @@unique([productoId, talla, color])
}

model MultimediaProducto {
  id         Int      @id @default(autoincrement())
  productoId Int
  url        String
  esImagen   Boolean  @default(true)
  orden      Int      @default(0)
  producto   Producto @relation(fields: [productoId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([productoId, orden])
}

model Pedido {
  id             Int             @id @default(autoincrement())
  fechaPedido    DateTime        @default(now())
  estado         EstadoPedido    @default(PENDIENTE)
  total          Decimal         @db.Decimal(65, 2)
  direccionEnvio String
  usuarioId      Int
  detalles       DetallePedido[]
  usuario        Usuario         @relation(fields: [usuarioId], references: [id], onUpdate: NoAction)
}

model DetallePedido {
  id             Int              @id @default(autoincrement())
  cantidad       Int
  precioUnitario Decimal          @db.Decimal(65, 2)
  pedidoId       Int
  varianteId     Int
  pedido         Pedido           @relation(fields: [pedidoId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  variante       VarianteProducto @relation(fields: [varianteId], references: [id], onUpdate: NoAction)
}

enum RolUsuario {
  CLIENTE
  ADMIN
}

enum EstadoPedido {
  PENDIENTE
  PAGADO
  ENVIADO
  ENTREGADO
  CANCELADO
}

// ==========================================================
// ENUMERACIONES (ENUMS)
// ==========================================================

// Roles permitidos para los usuarios
enum RolUsuario {
  CLIENTE
  ADMIN
}

// Estados posibles de un pedido
enum EstadoPedido {
  PENDIENTE    // Recibido, esperando confirmación/pago
  PAGADO       // Pago confirmado
  PROCESANDO   // En preparación
  ENVIADO      // Entregado a la paquetería
  ENTREGADO    // Confirmado por el cliente
  CANCELADO    // Pedido cancelado
}